<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<title></title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		
		<link rel="stylesheet" href="css/mui.min.css">
		<link rel="stylesheet" href="css/invest.css">
		
	</head>

	<body>
		<!--下拉刷新容器-->
		<div id="pullrefresh" class="mui-content mui-scroll-wrapper">
			<div class="mui-scroll">
				<!--数据列表-->
				<div id="invest-warp">
					<ul id="product-list" class="ui_item_cell ui_cell_explain"  data='{page:0,borrow_type:0}'>
						
					</ul>
				</div>
				
			</div>
		</div>
		
		
		
		
		<script src="js/jquery-1.11.2.min.js"></script>
		<script src="js/mui.min.js"></script>
		<script src="js/template.js"></script>
		<script src="js/template.function.js"></script>
		<script src="js/api.js"></script>
		<script>
			mui.init({
				preloadPages:[{
				id:'notice_detail.html',
				url:'notice_detail.html'
				}],
				pullRefresh: {
					container: '#pullrefresh',
					down: {
						callback: pulldownRefresh
					},
					up: {
						contentrefresh: '正在加载...',
						callback: pullupRefresh
					}
				}
			});
			
			
			/**
			 * 下拉刷新具体业务实现
			 */
			function pulldownRefresh() {
				setTimeout(function() {
					var table = document.body.querySelector('.ui_item_cell');
					//var cells = document.body.querySelectorAll('.mui-table-view-cell');
					table.innerHTML ="";
					//console.log(JSON.stringify(cells));
					request = {'type_id': 6, 'order':'order_asc','epage':20,'page':1};
					articles.GetList({'request':request},function(res){
						//for (var i = cells.length, len = i + 20; i < len; i++) {
						for (var i = 0, len = i + 20; i < len; i++) {
							var li = document.createElement('li');
							li.className = 'mui-table-view-cell';
							var item=res['list'][i];
							li.innerHTML =	'<div class="invest-money">可投金额 : <span class="invest-red">95,450元</span></div><i class="invest-dan">单</i><h2 class="invest-title">XCH20160505001A</h2>'+
				   		    '<p class="invest-border"></p>'+
				   			'<div class="invest-left">'+		   	
				   					'<div class="invest-lv">14.40<span class="invest-wei hong">%<span></span></div>'+
				   					'<div class="invest-tian">30<span class="invest-wei">天</span></div>'+
				   					'<div class="invest-je">1,500,300<span class="invest-wei">元</span></div>'+
				   		    		'<div class="invest-jdt"></div>'+
						   			'<div class="invest-hjdt"></div>'+
				   			'</div>'+		   			
				   			'<div class="invest-right">'+
				   		         '<a class="invest-botton">抢购</a>'+
				   			'</div>';
							table.appendChild(li);
						}
						
					})
					mui('#pullrefresh').pullRefresh().endPulldownToRefresh(); //refresh completed
				}, 500);
			}
			var count = 0;
			
			
			/**
			 * 上拉加载具体业务实现
			 */
			function pullupRefresh() {
				setTimeout(function() {
					mui('#pullrefresh').pullRefresh().endPullupToRefresh((++count > 2)); //参数为true代表没有更多数据了。
					var table = document.body.querySelector('.ui_item_cell');
					var cells = document.body.querySelectorAll('.li_item_cell');
					//request = {'type_id': 6, 'order':'order_asc','epage':20,'page':count};
					
					data='{page:0,borrow_type:0}';
					data = eval("(" + data + ")");
					borrow_type = data.borrow_type || "";
					borrow_period = data.borrow_period || "";
					dan = data.dan || "";
					
					var request = {'borrow_type':borrow_type,'page':count,'borrow_period':borrow_period,'dan':dan};
					
					product.list({'request':request},function(res){
						//console.log(JSON.stringify(res));
						//for (var i = cells.length, len = i + 20; i < len; i++) {
						for (var i = 0, len = i + 20; i < len; i++) {
							
							var li = document.createElement('li');
							li.className = 'li_item_cell';
							var item=res['list'][i];
							
							if(item){
								if(item.dan == 1){
									str1='<i class="invest-dan">单</i>';
								}
								else if(item.borrow_type == 7){
									str1='<i class="invest-xin">新</i>';
								}
								else if(item.borrow_type == 6){
									str1='<i class="invest-ju">聚</i>';
								}
								scale=item.borrow_account_scale;
							
							
								li.innerHTML =	
					   			'<div class="invest-money">可投金额 : <span class="invest-red">'+item.borrow_account_wait+'元</span></div>'+str1+'<h2 class="invest-title">'+item.name+'</h2>'+
					   		    '<p class="invest-border"></p>'+
					   			'<div class="invest-left">'+		   	
					   					'<div class="invest-lv">'+item.borrow_apr+'<span class="invest-wei hong">%<span></span></div>'+
					   					'<div class="invest-tian">'+Math.ceil(item.borrow_period*30)+'<span class="invest-wei">天</span></div>'+
					   					'<div class="invest-je">'+item.borrow_nid+'<span class="invest-wei">元</span></div>'+
					   		    		'<div class="invest-jdt" ></div>'+
							   			'<div class="invest-hjdt" style="width:'+scale+'%"></div>'+
					   			'</div>'+		   			
					   			'<div class="invest-right">'+
					   		         '<a href="javascript:;"  data="'+item.borrow_nid+'" class="tap invest-botton">抢购</a>'+
					   		        /*'<a href="pshow.html?nid=full_success&article_id='+item.borrow_nid+'&id='+item.id+'" data="'+item.borrow_nid+'" class="tap invest-botton">抢购</a>'+*/
					   		        
					   			'</div>';
					   			
				   			}
							table.appendChild(li);
						}
						
					})
				}, 500);
			}
			
			mui.plusReady(function() {
				
				
				setTimeout(function() {
					mui('#pullrefresh').pullRefresh().pullupLoading();
				}, 200);
				var detailPage = null;
				mui("#product-list").on('tap', 'a.invest-botton', function(e){
					
					e.stopPropagation();
					
					var data = this.getAttribute('data');
					data = eval("(" + data + ")");
					alert(data)
					//获得详情页面
					if(!detailPage){
					detailPage = plus.webview.getWebviewById('notice_detail.html');
					}
					alert(detailPage)
					//触发详情页面的newsId事件
					mui.fire(detailPage,'newsId',{
					id:data
					});
					//打开详情页面
					mui.openWindow({
					id:'notice_detail.html'
					});
					
				})

			});
			
			function getLocalTime(nS) {     
		       return new Date(parseInt(nS) * 1000).toLocaleString().replace(/年|月/g, "-").replace(/日/g, " ").replace('GMT+8', "");      
		    } 
			
			
			
		</script>
	</body>

</html>